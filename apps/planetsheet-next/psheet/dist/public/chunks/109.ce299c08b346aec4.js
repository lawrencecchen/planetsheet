"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[109],{7109:function(e,t,n){n.r(t),n.d(t,{default:function(){return $}});var a=n(7568),l=n(4051),r=n.n(l),o=n(5893),i=n(1278),s=n(7487),c=n(828),u=n(9579),d=n(6010);function m(e){var t,n,a=(0,s.useSearch)(),l=Object.entries(e.schemas).sort((function(e,t){return"public"===e[0]?-1:1}));return(0,o.jsx)("div",{className:"border-r h-full overflow-hidden flex flex-col",style:{minWidth:240,width:240},children:(0,o.jsxs)("div",{className:"py-2 h-full flex flex-col",children:[(0,o.jsx)(u.fC,{type:"multiple",defaultValue:["tables"],className:"grow flex flex-col overflow-auto",children:(0,o.jsxs)(u.ck,{value:"tables",className:"grow flex flex-col",children:[(0,o.jsx)(u.h4,{className:"sticky top-0 bg-white z-20",children:(0,o.jsxs)(u.xz,{className:"px-1 py-0.5 w-full text-left cursor-default flex items-center group",children:[(0,o.jsx)("div",{className:"i-material-symbols-chevron-right-rounded group-radix-state-open:rotate-90 text-base"}),(0,o.jsx)("div",{className:"ml-2 text-xs font-bold",children:"Tables"})]})}),(0,o.jsx)(u.VY,{className:"",children:(0,o.jsx)("ul",{className:"pb-4",children:(0,o.jsx)(u.fC,{type:"multiple",defaultValue:[null!==(n=a.schema)&&void 0!==n?n:null===(t=l[0])||void 0===t?void 0:t[0]],children:l.map((function(e){var t=(0,c.Z)(e,2),n=t[0],l=t[1];return(0,o.jsx)(u.ck,{value:n,asChild:!0,children:(0,o.jsxs)("li",{children:[(0,o.jsx)(u.h4,{className:"sticky top-5 bg-white z-10",children:(0,o.jsxs)(u.xz,{className:"text-sm px-3 py-0.5 w-full text-left cursor-default flex items-center group",children:[(0,o.jsx)("div",{className:(0,d.Z)("i-material-symbols-folder group-radix-state-closed:block group-radix-state-open:hidden text-neutral-700")}),(0,o.jsx)("div",{className:(0,d.Z)("i-material-symbols-folder-open group-radix-state-closed:hidden group-radix-state-open:block text-neutral-700")}),(0,o.jsx)("div",{className:"ml-1",children:n})]})}),(0,o.jsx)(u.VY,{children:(0,o.jsx)("ul",{children:l.map((function(e){return(0,o.jsx)("li",{children:(0,o.jsxs)(s.Link,{search:{schema:e.table_schema,table:e.table_name},draggable:!1,className:(0,d.Z)("flex items-center w-full px-3 cursor-default py-0.5 group pl-7",{"text-neutral-900 active:bg-blue-600 active:text-neutral-50":a.table!==e.table_name,"bg-neutral-200/80 focus:bg-blue-600 focus:text-neutral-50":a.table===e.table_name}),children:[(0,o.jsx)("div",{className:(0,d.Z)("i-material-symbols-table text-lg text-neutral-600 group-active:text-neutral-50 min-w-[18px]",{"group-focus:text-neutral-50":a.table===e.table_name})}),(0,o.jsx)("div",{className:"text-[13px] ml-1 text-ellipsis overflow-hidden",children:e.table_name})]})},"".concat(e.table_schema,".").concat(e.table_name))}))})})]})},n)}))})})})]})}),(0,o.jsxs)("a",{href:"https://github.com/lawrencecchen/planetsheet",target:"_blank",rel:"noopener noreferrer",className:"hidden items-center gap-2 cursor-pointer py-1 px-2 text-sm text-slate-700 hover:bg-slate-100 hover:text-slate-900 md:flex",children:[(0,o.jsx)("div",{className:"text-brand-800 flex h-4 w-4 items-center justify-center",children:(0,o.jsx)("div",{className:"text-scale-900 flex h-3 w-3 items-center justify-center transition-all group-hover:h-4 group-hover:w-4 group-hover:text-pink-900 group-focus:h-4 group-focus:w-4 group-focus:text-yellow-900",children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:14,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"",children:(0,o.jsx)("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})})}),(0,o.jsx)("span",{className:"truncate",children:"Star us on GitHub"})]})]})})}function h(){var e=i.d.useQuery(["information_schema.tables"]),t=e.data,n=e.isLoading;return!t||n?(0,o.jsx)("div",{children:"Loading..."}):(0,o.jsxs)("div",{className:"flex h-screen max-h-screen",children:[(0,o.jsx)(m,{schemas:t}),(0,o.jsx)(s.Outlet,{})]})}var f=n(4924),v=n(6042),x=n(9396),p=n(9815),b=n(1604),g=b.ZP.array(b.ZP.union([b.ZP.string(),b.ZP.object({column:b.ZP.string(),order:b.ZP.enum(["asc","desc"]).optional(),nulls:b.ZP.enum(["first","last"]).optional()})])).nullish(),w=b.ZP.object({table_name:b.ZP.string().min(1),table_schema:b.ZP.string().min(1),limit:b.ZP.number().default(300),offset:b.ZP.number().default(0),orderBy:g}),y=n(3590),j=n(7486),_=n(7294);function N(e){var t,n,a=(null===(t=e.column)||void 0===t?void 0:t.is_nullable)?"NULL":"";switch(null===(n=e.column)||void 0===n?void 0:n.data_type){case"text":return(0,o.jsx)("input",{id:e.id,type:"text",className:"w-full border text-xs rounded-sm p-1",value:e.value,placeholder:a,onChange:function(t){var n;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,t.target.value)}});case"integer":return(0,o.jsx)("input",{id:e.id,type:"number",className:"w-full border text-xs rounded-sm p-1",value:e.value,placeholder:a,onChange:function(t){var n;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,t.target.valueAsNumber)}});case"boolean":return(0,o.jsxs)("select",{id:e.id,className:"w-full border text-xs rounded-sm p-1 bg-white",value:e.value,onChange:function(t){var n;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,t.target.value)},children:[(0,o.jsx)("option",{value:"true",children:"TRUE"}),(0,o.jsx)("option",{value:"false",children:"FALSE"}),(0,o.jsx)("option",{value:"null",children:"NULL"}),(0,o.jsx)("option",{value:"default",children:"DEFAULT"})]});case"timestamp without time zone":return(0,o.jsx)("input",{id:e.id,type:"datetime-local",className:"w-full border text-xs rounded-sm p-1 bg-white",value:(0,y.Z)(new Date(e.value),"yyyy-MM-dd'T'hh:mm:ss"),placeholder:a,onChange:function(t){var n;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,t.target.valueAsDate)}});case"jsonb":return(0,o.jsx)("textarea",{id:e.id,className:"w-full border text-xs rounded-sm p-1",rows:10,value:JSON.stringify(e.value,null,2),placeholder:a,onChange:function(t){var n;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,t.target.value)}});default:var l="string"===typeof e.value?e.value:JSON.stringify(e.value);return(0,o.jsx)("input",{id:e.id,type:"text",className:"w-full border text-xs rounded-sm p-1",value:l,placeholder:a,onChange:function(t){var n;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,t.target.value)}})}}function Z(e){var t=e.selectedRow[e.column.column_name],n=(0,_.useState)(t),a=n[0],l=n[1];(0,_.useEffect)((function(){l(t)}),[t]);var r=(0,_.useRef)();return(0,o.jsxs)("li",{children:[(0,o.jsxs)("div",{className:"flex justify-between text-xs text-neutral-600 cursor-default",children:[(0,o.jsx)("label",{htmlFor:"".concat(e.column.column_name,"-input"),children:e.column.column_name}),(0,o.jsx)("div",{children:e.column.data_type})]}),(0,o.jsx)("div",{className:"text-sm mt-0.5",children:(0,o.jsx)(N,{id:"".concat(e.column.column_name,"-input"),column:e.column,value:null!==a&&void 0!==a?a:"",onChange:function(t){var n,a,o;l(t),null===(n=e.onChange)||void 0===n||n.call(e,t),null===(a=r.current)||void 0===a||null===(o=a.cancel)||void 0===o||o.call(a);var i=(0,j.Z)((function(){var n;null===(n=e.onDebouncedChange)||void 0===n||n.call(e,t)}),300);i(),r.current=i}})})]})}function k(){var e=(0,s.useSearch)(),t=(0,s.useNavigate)();if(!e.table||!e.schema)throw t({to:"/app",replace:!0});var n=i.d.useMutation(["editCell"]),a=i.d.useContext(),l=H({table_name:e.table,table_schema:e.schema}),r=l.columns,u=l.data,d=function(e){var t=(0,_.useMemo)((function(){var t=e.data,n=e.rowSelection,a=e.cellSelection;if(!t)return null;if(a)return t[a.row];if(n){var l=[],r=!0,o=!1,i=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0)for(var d=(0,c.Z)(s.value,2),m=d[0],h=d[1],f=m;f<h;f++)l.push(f)}catch(v){o=!0,i=v}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return 1===l.length?t[l[0]]:null}return null}),[e]);return t}({rowSelection:e.rowSelection,cellSelection:e.cellSelection,data:u});if(!r||!u)return(0,o.jsx)("div",{children:"Loading..."});if(!d||d.____new_planetsheet_row)return null;var m=w.parse({table_name:e.table,table_schema:e.schema,limit:e.limit,offset:e.offset});return(0,o.jsx)("div",{className:"border-l h-screen p-2 bg-neutral-100 overflow-y-auto overflow-x-hidden",style:{minWidth:300,width:300},children:d?(0,o.jsx)("ul",{className:"space-y-2",children:r.map((function(e){return(0,o.jsx)(Z,{column:e,selectedRow:d,onDebouncedChange:function(t){return a={column:e.column_name,newValue:t},n.mutate({table_name:m.table_name,table_schema:m.table_schema,column:a.column,identifier_column:"id",identifier_value:d.id,value:a.newValue}),void console.log(["tableData",m]);var a},onChange:function(t){return n={column:e.column_name,newValue:t},void a.setQueryData(["tableData",m],(function(e){if(e)return e.map((function(e){return e.id===d.id?(0,x.Z)((0,v.Z)({},e),(0,f.Z)({},n.column,n.newValue)):e}));console.log("no oldData")}));var n}},e.column_name)}))}):(0,o.jsx)("div",{className:"py-4 text-sm text-neutral-700 text-center",children:"Nothing selected"})},d)}var S=n(6387),C=n(3378),D=n(2765),O=n(1381),L=n(2902),P=n(5178),E=n(2830),M=n.n(E);function W(){var e=(0,s.useSearch)();return(0,_.useMemo)((function(){return w.parse({table_name:e.table,table_schema:e.schema,limit:e.limit,offset:e.offset,orderBy:e.orderBy})}),[e])}function H(e){var t=i.d.useQuery(["information_schema.columns",{table_name:e.table_name,table_schema:e.table_schema}]),n=t.data,a=(t.isLoading,W()),l=i.d.useQuery(["tableData",a]),r=l.data;l.isLoading;return{columns:n,data:r}}function A(e){return e.map((function(e){return{title:e.column_name,id:e.column_name}}))}var R=new Set([C.p6.Text,C.p6.Boolean]),T={text:"",boolean:!1,jsonb:"{}",integer:"","timestamp without time zone":(new Date).toString()};function z(e){var t=e.data_type;return"id"===e.column_name?M()():e.column_default?(console.log("has default",e),e.column_default):t in T?T[t]:(console.log("unknown columnDataType",t),"")}function Q(e){var t=(0,_.useState)(A(e.columns)),n=t[0],l=t[1];(0,_.useEffect)((function(){l(A(e.columns))}),[e.columns]);var u=(0,_.useMemo)((function(){return n.map((function(e){return e.id}))}),[n]),d=(0,s.useNavigate)(),m=i.d.useContext(),h=i.d.useMutation("editCell"),b=i.d.useMutation("addRows",{onSuccess:function(){return m.invalidateQueries(["tableData",e.metadata])}}),g=(0,_.useState)([]),w=g[0],j=g[1];function N(){return(N=(0,a.Z)(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,b.mutateAsync({table_name:e.metadata.table_name,table_schema:e.metadata.table_schema,rows:w});case 3:j([]),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.log(t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))).apply(this,arguments)}var Z=(0,_.useCallback)((function(t,n){if(R.has(n.kind)){var a=(0,c.Z)(t,2),l=a[0],r=a[1],o=e.columns[l].column_name,i=u[l];if(r>=e.data.length){var s=r-e.data.length;j((0,L.ZP)((function(e){e[s][o]=n.data})))}else{var d=e.data[r];if(!i||d&&!(i in d))throw new Error("invalid cell");if(!("id"in d))throw new Error("row does not have id");h.mutate({table_name:e.metadata.table_name,table_schema:e.metadata.table_schema,column:o,identifier_column:"id",identifier_value:d.id,value:n.data}),m.setQueryData(["tableData",e.metadata],(function(e){if(e){var t=e.map((function(e){return e.id===d.id?(0,x.Z)((0,v.Z)({},e),(0,f.Z)({},i,n.data)):e}));return t}console.log("no oldData")}))}}else console.log("unhandled value kind",n)}),[u,e.data,w]),E=(0,_.useCallback)((function(t){var n=(0,c.Z)(t,2),a=n[0],l=n[1],r=l>=e.data.length,o=(r?w:e.data)[r?l-e.data.length:l],i=u[a],s=e.columns[a];if(!i)throw new Error("key not found");var d=null===o||void 0===o?void 0:o[i],m=r?{bgCell:D.er.yellow4}:{};switch(null===s||void 0===s?void 0:s.data_type){case"text":return{kind:C.p6.Text,displayData:String(null!==d&&void 0!==d?d:""),allowOverlay:!0,readonly:!1,data:d,themeOverride:m};case"boolean":return{kind:C.p6.Boolean,allowOverlay:!1,readonly:!1,data:Boolean(d),themeOverride:m};case"jsonb":return{kind:C.p6.Text,displayData:JSON.stringify(d),allowOverlay:!0,readonly:!1,data:JSON.stringify(d),themeOverride:m};case"timestamp without time zone":return{kind:C.p6.Text,allowOverlay:!1,displayData:r&&s.column_default||((0,O.Z)(d)?(0,y.Z)(d,"yyyy-MM-dd HH:mm:ss"):""),data:d,themeOverride:m};default:return{kind:C.p6.Text,displayData:String(d),allowOverlay:!0,readonly:!1,data:d,themeOverride:m}}}),[u,e.data,e.columns,w]),M=((0,_.useCallback)((function(e,t){console.log(e,t)}),[]),(0,_.useState)()),W=M[0],H=M[1];(0,_.useEffect)((function(){var e,t,n=null===(e=null===W||void 0===W?void 0:W.rows)||void 0===e?void 0:e.items;if(null===W||void 0===W||null===(t=W.current)||void 0===t?void 0:t.cell){var a=(0,c.Z)(W.current.cell,2),l=a[0],r=a[1];d({search:function(e){return(0,x.Z)((0,v.Z)({},e),{cellSelection:{column:l,row:r},rowSelection:void 0})}})}else(null===n||void 0===n?void 0:n.length)>0?d({search:function(e){return(0,x.Z)((0,v.Z)({},e),{cellSelection:void 0,rowSelection:n})}}):d({search:function(e){return(0,x.Z)((0,v.Z)({},e),{cellSelection:void 0,rowSelection:void 0})}})}),[W]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(P.f6,{theme:{accentColor:D.MA.gray11,accentFg:D.MA.gray1,accentLight:D.MA.gray3,baseFontStyle:"12px",headerFontStyle:"bold 12px"},children:(0,o.jsx)(S.ZP,{columns:n,getCellContent:E,rows:e.data.length+w.length,smoothScrollX:!0,smoothScrollY:!0,height:"100%",width:"100%",overscrollX:100,rowHeight:24,headerHeight:28,rowMarkers:"both",onColumnResize:function(e,t){l((function(n){return n.map((function(n){return n.id===e.id?(0,x.Z)((0,v.Z)({},n),{width:t}):n}))}))},onRowAppended:function(){var t={},n=!0,a=!1,l=void 0;try{for(var r,o=e.columns[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var i=r.value;t[i.column_name]=z(i)}}catch(s){a=!0,l=s}finally{try{n||null==o.return||o.return()}finally{if(a)throw l}}j((function(e){return(0,p.Z)(e).concat([t])}))},trailingRowOptions:{sticky:!1,tint:!1,hint:"New row"},onCellEdited:Z,onDelete:function(e){return console.log(e.rows),!0},rightElement:(0,o.jsx)(k,{}),rightElementSticky:!0,gridSelection:W,onGridSelectionChange:function(e){return H(e)}})}),w.length>0&&(0,o.jsxs)("div",{className:"bg-yellow-4 absolute bottom-0 inset-x-0 py-1 text-xs px-4 justify-between flex items-center w-full",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("button",{className:"bg-white rounded-md border px-2 py-0.5 select-none cursor-default active:bg-neutral-100",onClick:function(){j([])},children:"Discard changes"}),(0,o.jsxs)("div",{className:"ml-2",children:[w.length," new ",w.length>1?"rows":"row"]})]}),(0,o.jsx)("div",{children:(0,o.jsx)("button",{className:"bg-white rounded-md border px-2 py-0.5 select-none cursor-default active:bg-neutral-100",onClick:function(){return N.apply(this,arguments)},children:"Save changes"})})]})]})}function V(){var e=(0,s.useSearch)(),t=(0,s.useNavigate)();if(!e.table||!e.schema)throw t({to:"/app",replace:!0});var n=W(),a=H(n),l=a.columns,r=a.data;return l&&r?(0,o.jsx)("div",{className:"grow relative",children:(0,o.jsx)(Q,{columns:l,data:r,metadata:n})}):(0,o.jsx)("div",{children:"Loading..."})}var B=n(9008),F=n.n(B);function J(){return(0,o.jsx)("div",{className:"p-4 text-sm",children:"Open a table or create a new query."})}for(var U=n(796),q=n(2309),Y=[],G=0;G<1e4;G++)Y.push({name:q.We.name.findName(),age:q.We.random.numeric(),email:q.We.internet.email(),street:q.We.address.street(),phone:q.We.phone.imei(),description:q.We.lorem.lines(),vehicle:q.We.vehicle.bicycle()});function X(e){var t=Math.ceil(e.height/e.rowHeight);return(0,o.jsx)(U.Hf,{width:e.width,height:e.height,children:(0,o.jsx)(U.mh,{children:Array.from({length:t}).map((function(t,n){return(0,o.jsx)(U.x1,{points:[0,n*e.rowHeight,e.width,n*e.rowHeight],strokeWidth:1,stroke:"black"},n)}))})})}var I=function(){return console.log(Y),(0,o.jsx)(X,{width:window.innerWidth,height:window.innerHeight,rowHeight:20})},K=new s.ReactLocation,$=function(){var e=i.d.useContext();return(0,o.jsxs)("div",{children:[(0,o.jsxs)(F(),{children:[(0,o.jsx)("title",{children:"Planetsheet"}),(0,o.jsx)("meta",{name:"description",content:"amazing sql editor."}),(0,o.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,o.jsx)(s.Router,{location:K,routes:[{path:"app/sheet",element:(0,o.jsx)(I,{})},{path:"app/:db",element:(0,o.jsx)(h,{}),loader:(0,a.Z)(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.prefetchQuery(["information_schema.tables"]),t.abrupt("return",{});case 2:case"end":return t.stop()}}),t)}))),children:[{id:"db-empty",path:"/",search:function(e){return!e.schema&&!e.table},element:(0,o.jsx)(J,{})},{id:"db-table",path:"/",search:function(e){return e.schema&&e.table},element:(0,o.jsx)(V,{}),loader:function(){var t=(0,a.Z)(r().mark((function t(n){var a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((a=n.search).table&&a.schema){t.next=3;break}throw new Error('"table" and "schema" are required');case 3:return Promise.all([e.prefetchQuery(["information_schema.columns",{table_name:a.table,table_schema:a.schema}]),e.prefetchQuery(["tableData",{table_name:a.table,table_schema:a.schema,limit:a.limit,offset:a.offset}])]),t.abrupt("return",{});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]}]})]})}}}]);